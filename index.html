<!DOCTYPE html>
<html lang="en">



<body>
  <main>
<div style="width: 400px; height: 480px; border: 2px solid #333; margin: 20px auto; position: relative; background: #7CFC00; font-family: Arial, sans-serif;">
  <!-- Row of 10 brown tiles near the top -->
  <div id="tilesRow" style="display: flex; justify-content: center; gap: 4px; position: absolute; top: 15px; left: 50%; transform: translateX(-50%); width: 380px; z-index: 10;">
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
    <div class="tile" style="background: sienna; width: 36px; height: 30px; border-radius: 4px;"></div>
  </div>
  <!-- Fence line (tan) at 400px -->
  <div style="position: absolute; bottom: 80px; left: 0; width: 100%; height: 10px; background: tan; z-index: 15;"></div>
  <!-- Tool selection area (below shop but above grass) -->
  <div style="position: absolute; bottom: 10px; left: 0; width: 100%; display: flex; justify-content: center; gap: 40px; z-index: 20;">
    <div onclick="selectTool('hoe')" style="cursor: pointer; font-size: 20px;">ü™í</div>
    <div onclick="selectTool('watering-can')" style="cursor: pointer; font-size: 20px;">üíß</div>
    <div onclick="selectTool('shovel')" style="cursor: pointer; font-size: 20px;">üõ†Ô∏è</div>
  </div>
  <!-- Small building -->
  <div id="building" style="width: 60px; height: 80px; background: gray; border-radius: 6px; position: absolute; bottom: 100px; right: 20px; z-index: 10; box-shadow: 2px 2px 6px rgba(0,0,0,0.4);">
    <div style="width: 20px; height: 20px; background: #444; margin: 10px auto; border-radius: 3px;"></div>
  </div>
  <!-- Movable circle -->
  <div id="player" style="width: 40px; height: 40px; background: #2196f3; border-radius: 50%; position: absolute; top: 180px; left: 180px; z-index: 20; display: flex; align-items: center; justify-content: center; font-size: 24px;"></div>
  <!-- Shop tab (hidden by default) -->
  <div id="shopTab" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 100px; background: #fff; border-top: 2px solid #333; box-shadow: 0 -5px 10px rgba(0,0,0,0.2); padding: 15px; box-sizing: border-box; font-size: 16px; color: #333; display: none; z-index: 25;">
    <strong>Shop:</strong> Welcome! You can buy cool upgrades here.
  </div>
  <!-- Wheat seeds counter -->
  <div id="seedCounter" style="position: absolute; right: 15px; bottom: 15px; z-index: 30; background: #fff8; padding: 6px 12px; border-radius: 8px; font-size: 18px; color: #333;">
    Wheat Seeds: <span id="wheatSeedCount">0</span>
  </div>
  <!-- Grass container -->
  <div id="grassContainer"></div>
  <script>
    const player = document.getElementById('player');
    const building = document.getElementById('building');
    const shopTab = document.getElementById('shopTab');
    const tiles = Array.from(document.querySelectorAll('.tile'));
    const tilesRow = document.getElementById('tilesRow');
    const grassContainer = document.getElementById('grassContainer');
    const wheatSeedCountEl = document.getElementById('wheatSeedCount');

    const containerSize = 400;
    const playerSize = 40;

    let posX = 180;
    let posY = 180;
    const speed = 3;
    let selectedTool = '';
    const keys = { w: false, a: false, s: false, d: false };

    let wetTiles = Array(tiles.length).fill(false);
    let dryTileTimeouts = Array(tiles.length).fill(null);

    // Grass and wheat seed variables
    let grassList = [];
    let wheatSeedCount = 0;

    window.addEventListener('keydown', (e) => {
      const key = e.key.toLowerCase();
      if (key in keys) {
        keys[key] = true;
        e.preventDefault();
      }
    });

    window.addEventListener('keyup', (e) => {
      const key = e.key.toLowerCase();
      if (key in keys) {
        keys[key] = false;
        e.preventDefault();
      }
    });

    function isColliding(rect1, rect2) {
      return !(
        rect1.right <= rect2.left ||
        rect1.left >= rect2.right ||
        rect1.bottom <= rect2.top ||
        rect1.top >= rect2.bottom
      );
    }

    function canMove(newX, newY) {
      const newRect = {
        left: newX,
        right: newX + playerSize,
        top: newY,
        bottom: newY + playerSize
      };

      // Building collision
      const buildingRectAbs = building.getBoundingClientRect();
      const containerRect = player.parentElement.getBoundingClientRect();
      const buildingRel = {
        left: buildingRectAbs.left - containerRect.left,
        right: buildingRectAbs.right - containerRect.left,
        top: buildingRectAbs.top - containerRect.top,
        bottom: buildingRectAbs.bottom - containerRect.top
      };

      if (isColliding(newRect, buildingRel)) return false;
      if (newX < 0 || newY < 0 || newX > containerSize - playerSize || newY > containerSize - playerSize) return false;

      return true;
    }

    function getTileRect(tile) {
      const containerRect = player.parentElement.getBoundingClientRect();
      const tileRect = tile.getBoundingClientRect();
      return {
        left: tileRect.left - containerRect.left,
        right: tileRect.right - containerRect.left,
        top: tileRect.top - containerRect.top,
        bottom: tileRect.bottom - containerRect.top
      };
    }

    function wetNearbyTiles() {
      if (selectedTool !== 'watering-can') return;

      const playerRect = {
        left: posX,
        right: posX + playerSize,
        top: posY,
        bottom: posY + playerSize
      };

      tiles.forEach((tile, i) => {
        const tileRect = getTileRect(tile);
        if (isColliding(playerRect, tileRect)) {
          if (!wetTiles[i]) {
            wetTiles[i] = true;
            if (dryTileTimeouts[i]) clearTimeout(dryTileTimeouts[i]);
            dryTileTimeouts[i] = setTimeout(() => {
              wetTiles[i] = false;
              renderTiles();
            }, 120000);
          }
        }
      });
    }

    function renderTiles() {
      tiles.forEach((tile, i) => {
        tile.style.background = wetTiles[i] ? 'rgb(120,65,30)' : 'sienna';
      });
    }

    // GRASS LOGIC
    function spawnGrass() {
      // Spawn at random position not overlapping building or outside bounds
      let tries = 0;
      let grassX, grassY;
      let ok = false;
      while (!ok && tries < 20) {
        grassX = Math.floor(Math.random() * (containerSize - 24));
        grassY = Math.floor(Math.random() * (containerSize - 24));
        // Don't spawn on shop/building
        const grassRect = {
          left: grassX,
          right: grassX + 24,
          top: grassY,
          bottom: grassY + 24
        };
        const buildingRectAbs = building.getBoundingClientRect();
        const containerRect = player.parentElement.getBoundingClientRect();
        const buildingRel = {
          left: buildingRectAbs.left - containerRect.left,
          right: buildingRectAbs.right - containerRect.left,
          top: buildingRectAbs.top - containerRect.top,
          bottom: buildingRectAbs.bottom - containerRect.top
        };
        ok = !isColliding(grassRect, buildingRel);
        tries++;
      }
      // Create grass element
      const grass = document.createElement('div');
      grass.className = 'grass-item';
      grass.style.position = 'absolute';
      grass.style.left = grassX + 'px';
      grass.style.top = grassY + 'px';
      grass.style.width = '24px';
      grass.style.height = '24px';
      grass.style.background = 'linear-gradient(135deg,#6b8e23 70%,#9acd32 100%)';
      grass.style.borderRadius = '50%';
      grass.style.boxShadow = '0 2px 8px #0002';
      grass.style.zIndex = 18;
      grass.style.display = 'flex';
      grass.style.alignItems = 'center';
      grass.style.justifyContent = 'center';
      grass.innerHTML = 'üå±';
      grassContainer.appendChild(grass);
      grassList.push({ el: grass, x: grassX, y: grassY });
    }

    function removeGrass(grassObj) {
      grassContainer.removeChild(grassObj.el);
      grassList = grassList.filter(g => g !== grassObj);
    }

    function checkGrassPickup() {
      // Only harvest grass if shovel is equipped
      if (selectedTool !== 'shovel') return;

      // Player rect
      const containerRect = player.parentElement.getBoundingClientRect();
      const playerRectAbs = player.getBoundingClientRect();
      const playerRect = {
        left: playerRectAbs.left - containerRect.left,
        right: playerRectAbs.right - containerRect.left,
        top: playerRectAbs.top - containerRect.top,
        bottom: playerRectAbs.bottom - containerRect.top
      };
      grassList.forEach(grassObj => {
        const grassRect = {
          left: grassObj.x,
          right: grassObj.x + 24,
          top: grassObj.y,
          bottom: grassObj.y + 24
        };
        if (isColliding(playerRect, grassRect)) {
          // 1/2 chance to get wheat seed
          if (Math.random() < 0.5) {
            wheatSeedCount++;
            wheatSeedCountEl.textContent = wheatSeedCount;
            // Optional: show feedback, e.g. flash, animation
          }
          removeGrass(grassObj);
        }
      });
    }

    // Spawn grass every 10 seconds
    setInterval(spawnGrass, 10000);

    function movePlayer() {
      let newX = posX;
      let newY = posY;

      if (keys.w) newY = Math.max(0, posY - speed);
      if (keys.a) newX = Math.max(0, posX - speed);
      if (keys.s) newY = Math.min(containerSize - playerSize, posY + speed);
      if (keys.d) newX = Math.min(containerSize - playerSize, posX + speed);

      if (canMove(newX, newY)) {
        posX = newX;
        posY = newY;
      }

      player.style.top = posY + 'px';
      player.style.left = posX + 'px';

      // Shop tab: open when touching the shop
      const containerRect = player.parentElement.getBoundingClientRect();
      const playerRectAbs = player.getBoundingClientRect();
      const playerRect = {
        left: playerRectAbs.left - containerRect.left,
        right: playerRectAbs.right - containerRect.left,
        top: playerRectAbs.top - containerRect.top,
        bottom: playerRectAbs.bottom - containerRect.top
      };

      const buildingRectAbs = building.getBoundingClientRect();
      const buildingRect = {
        left: buildingRectAbs.left - containerRect.left,
        right: buildingRectAbs.right - containerRect.left,
        top: buildingRectAbs.top - containerRect.top,
        bottom: buildingRectAbs.bottom - containerRect.top
      };

      if (isColliding(playerRect, buildingRect)) {
        shopTab.style.display = 'block';
      } else {
        shopTab.style.display = 'none';
      }

      wetNearbyTiles();
      renderTiles();
      checkGrassPickup();

      requestAnimationFrame(movePlayer);
    }

    function selectTool(tool) {
      const toolIcons = {
        'hoe': 'ü™í',
        'watering-can': 'üíß',
        'shovel': 'üõ†Ô∏è'
      };
      selectedTool = tool;
      player.innerText = toolIcons[tool] || '';
    }

    renderTiles();
    movePlayer();
  </script>
</div>

</body>

</html>
